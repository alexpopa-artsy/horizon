<ul>
  <% @projects.each do |project| %>
    <li>
      <%= project.name %>
      <ul>
        <% project.stages.order(position: :asc).each_cons(2) do |ahead, behind| %>
          <%
            comparison = project.snapshot&.comparisons&.detect{|c| c.behind_stage_id == behind.id && c.ahead_stage_id == ahead.id }
          %>
          <li>
            <%= ahead.name %> &rarr; <%= behind.name %>
            <% if comparison && !comparison.released? %>
              <ul>
                <% comparison.description.each do |line| %>
                  <li><%= gravatar_from_log_line(line) %> <%= line %></li>
                <% end %>
              </ul>
            <% end %>
          </li>
        <% end %>
      </ul>
    </li>
  <% end %>
</ul>
